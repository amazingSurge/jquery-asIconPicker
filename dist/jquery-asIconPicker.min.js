/*! asIconPicker - v0.1.0 - 2014-05-27
* https://github.com/amazingsurge/jquery-asIconPicker
* Copyright (c) 2014 amazingSurge; Licensed MIT */
(function(s,i,e,t){"use strict";var n="asIconPicker",a={namespace:"asIconPicker",source:!1,tooltip:!0,hasSearch:!0,extraClass:"fa",iconPrefix:"fa-",emptyText:"None Selected",searchText:"Search",cancelSelected:!0,keyboard:!0,name:null,flat:!1,iconPicker:function(){return'<div class="namespace-selector"><span class="namespace-selected-icon">None selected</span><span class="namespace-selector-arrow"><i></i></span></div><div class="namespace-selector-popup"><div class="namespace-icons-container"></div></div>'},iconSearch:function(){return'<div class="namespace-selector-search"><input type="text" name="" value="" placeholder="searchText" class="namespace-search-input"/><i class="asIcon-search"></i></div>'},formatNoMatches:function(){return"No matches found"},errorHanding:function(){},process:function(s){return s.match(this.iconPrefix)?s.replace(this.iconPrefix,""):s},parse:function(s){return s.match(this.iconPrefix)?s:iconPrefix+s},onInit:null,onReady:null,onAfterFill:null},h=s[n]=function(i,e){this.element=i,this.$element=s(i),this.name=this.$element.attr("name")?this.$element.attr("name"):e.name,this.options=s.extend({},a,e,this.$element.data()),this._plugin=n,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",search:this.namespace+"_with_search",active:this.namespace+"_active",flat:this.namespace+"_isFlat",hide:this.namespace+"_hide",hover:this.namespace+"_hover",mask:this.namespace+"-mask"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$wrapper.attr("tabindex","0");var t=this.options.iconPicker().replace(/namespace/g,this.namespace),h=this.options.iconSearch().replace(/namespace/g,this.namespace).replace(/searchText/g,this.options.searchText);this.$iconPicker=s(t),this.$iconContainer=this.$iconPicker.find("."+this.namespace+"-icons-container"),this.$iconSearch=s(h),this.options.hasSearch&&(this.$iconContainer.before(this.$iconSearch),this.$iconContainer.parent().addClass(this.classes.search),this.$searchIcon=this.$iconPicker.find("."+this.namespace+"-selector-search i"),this.iconsSearched=[],this.isSearch=!1),this.map={},this.bound=!1,this.current=this.$element.val(),this.source=[],this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()};h.prototype={constructor:h,_keyboard:{init:function(s){this.attach(s,this.gather(s))},destroy:function(s){s.$wrapper.off("keydown"),s.bound=!1},keys:function(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27}},horizontalChange:function(s){return this.$mask||this.options.flat?(this.index+=parseInt(s),this.index>=this.iconsAll.length?this.index=this.iconsAll.length-1:0>this.index&&(this.index=0),this.current=this.iconsAll[this.index],this.set(this.current),t):(this._open(),t)},verticalChange:function(s){if(!this.$mask&&!this.options.flat)return this._open(),t;var i=this.$iconContainer.find("."+this.namespace+"-list").width(),e=this.$iconContainer.find("."+this.namespace+"-list li").width(),n=Math.floor(i/e);if(s=parseInt(s),this.index>=0&&this.$iconContainer.find("."+this.namespace+"-group").text()){if(1===s){var a=this.$iconContainer.find("."+this.current).parent().siblings().length+1,h=this.$iconContainer.find("."+this.current).parents("."+this.namespace+"-group").next().find("li").length,r=this.$iconContainer.find("."+this.current).parent().index(),o=a%n;this.index+=r+n>=a&&h?r+o>=a&&o>0?r+o>=a+h?h:o:r+o+n>=a+h?o+h:o+n:n}else if(-1===s){var a=this.$iconContainer.find("."+this.current).parent().siblings().length+1,c=this.$iconContainer.find("."+this.current).parents("."+this.namespace+"-group").prev().find("li").length,r=this.$iconContainer.find("."+this.current).parent().index(),o=c%n;this.index-=r>o-1&&n>r?c>=n?n+o:r+1:o-1>=r?o:n}}else this.index+=n*s;this.index>=this.iconsAll.length?this.index=this.iconsAll.length-1:0>this.index&&(this.index=0),this.current=this.iconsAll[this.index],this.set(this.current)},enter:function(){this.$mask?this.current&&(this.set(this.current),this._hide()):this._open()},esc:function(){this.set(this.previous),this._hide()},tab:function(){this._hide()},gather:function(i){return{left:s.proxy(this.horizontalChange,i,"-1"),up:s.proxy(this.verticalChange,i,"-1"),right:s.proxy(this.horizontalChange,i,"1"),down:s.proxy(this.verticalChange,i,"1"),enter:s.proxy(this.enter,i),esc:s.proxy(this.esc,i)}},press:function(i){var e=i.keyCode||i.which;if(9===e&&this._keyboard.tab.call(this),e in this.map&&"function"==typeof this.map[e])return i.preventDefault(),this.map[e].call(this);var t=this;this.$iconPicker.find("."+this.namespace+"-search-input").one("keyup",function(){t.searching(s(this).val())})},attach:function(s,i){var e,n=this;for(e in i)if(i.hasOwnProperty(e)){var a=[],h=s._stringSeparate(e,"_"),r=h.length;if(1===r)a[0]=h[0].toUpperCase(),s.map[this.keys()[a[0]]]=i[e];else for(var o=0;h.length>o;o++)a[o]=h[o].toUpperCase(),0===o?s.map[this.keys()[a[0]]]===t&&(s.map[this.keys()[a[0]]]={}):s.map[this.keys()[a[0]]][this.keys()[a[o]]]=i[e]}s.bound||(s.bound=!0,s.$wrapper.on("keydown",function(i){n.press.call(s,i)}))}},init:function(){var i=this;if(this.$element.hide(),this.$element.before(this.$iconPicker),!this.options.source&&this.$element.is("select"))this.$element.children().each(s.proxy(function(e,t){var n=[];if("optgroup"===t.tagName.toLowerCase()){for(var a=s.extend({},s(t).data(),{label:t.label,options:[]}),h=0;s(t).children().length>h;h++)n=[],n.value=s(t).children().eq(h).val(),n.text=s(t).children().eq(h).text(),a.options.push(n);i.source.push(a)}else s(t).val()&&(n.value=s(t).val(),n.text=s(t).text(),this.source.push(n))},this));else for(var e in this.options.source){var n=[];if(this.options.source[e].label){var a=[];a.label=this.options.source[e].label,a.options=[];for(var h in this.options.source[e].options)n=[],n.value=parseInt(h)>=0?this.options.source[e].options[h]:h,n.text=this.options.source[e].options[h],a.options.push(n);this.source.push(a)}else n.value=e,n.text=this.options.source[e],this.source.push(n)}this.showLoading(),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide),i.options.flat?i._open():this.$wrapper.find("."+this.namespace+"-selector").on("click",function(){i._open()}),this.options.keyboard?this.$wrapper.on("focus",function(){i._keyboard.init(i)}):this.$iconPicker.find("."+this.namespace+"-search-input").keyup(s.proxy(function(e){i.searching(s(e.currentTarget).val())},this)),this.$iconPicker.find("."+this.namespace+"-selector-search").on("click",".asIcon-times",s.proxy(function(){this.$iconPicker.find("."+this.namespace+"-search-input").focus().select(),this.reset()},this)),this.$iconContainer.on("click","."+this.namespace+"-list li",s.proxy(function(i){return this.options.cancelSelected&&s(i.currentTarget).hasClass(this.namespace+"-current")?(s(i.currentTarget).removeClass(this.namespace+"-current"),this.set(),t):(this.set(s(i.currentTarget).data("class")),this._hide(),t)},this)).on("mouseenter","."+this.namespace+"-list li",s.proxy(function(i){this.highlight(s(i.currentTarget).data("class"))},this)).on("mouseleave","."+this.namespace+"-list li",s.proxy(function(){this.highlight()},this)),this.$iconContainer.on("change.asScrollable",function(s,e){i.value=e,i.shadow()}),this.$iconPicker.click(function(s){return s.stopPropagation(),i.$iconPicker.find("."+i.namespace+"-search-input").focus().select(),!1}),this.initialized=!0,this._trigger("ready")},_stringSeparate:function(s,i){var e=RegExp("[.\\"+i+"\\s].*?"),i=s.match(e),t=s.split(i);return t},showLoading:function(){this.$iconContainer.html('<span class="'+this.namespace+'-loading"><i></i></span>'),this.source.length>0&&this.fillIcon()},searching:function(i){var e=this;if(""===i)return this.reset(),t;this.$iconSearch.addClass(this.namespace+"-isSearching"),this.isSearch=!0,this.iconsSearched=[];for(var n,a=0;n=this.source[a];a++)if(n.label!==t){var h=[];h.label=n.label,h.options=s.grep(n.options,function(s){return e.replaceDiacritics(s.value||s).toLowerCase().search(i.toLowerCase())>=0}),h.options.length>0&&(this.iconsSearched.push(h),this.current=this.iconsSearched[0].options[0].value||this.iconsSearched[0].options[0])}else this.replaceDiacritics(n.value).toLowerCase().search(i.toLowerCase())>=0?this.iconsSearched.push(n):0,this.iconsSearched.length>0&&(this.current=this.iconsSearched[0].value);this.fillIcon()},fillIcon:function(){this.$iconContainer.data("scroll")!==t&&this.$iconContainer.asScrollable("destory");var i=[];if(this.iconsAll=[],i=this.isSearch?this.iconsSearched:this.source,1>i.length)return this.$iconContainer.html('<div class="'+this.namespace+'-noMatch">'+this.options.formatNoMatches()+"</div>"),t;this.$iconContainer.html("");for(var e,n=0;e=i[n];n++)if(e.label!==t){if(e.options.length)var a=s('<div class="'+this.namespace+'-group"><div class="'+this.namespace+'-group-label">'+e.label+':</div><ul class="'+this.namespace+'-list"></ul></div>').appendTo(this.$iconContainer);for(var h,r=0;h=e.options[r];r++)s("<li/>",{html:'<i class="'+this.options.extraClass+" "+(h.value||h)+'"></i>',title:this.options.tooltip?h.text||h:""}).data("class",h.value||h).appendTo(a.find("ul")),this.iconsAll.push(h.value||h)}else{var o=this.$iconContainer.children().last().attr("class");o!==this.namespace+"-list"&&s('<ul class="'+this.namespace+'-list"></ul>').appendTo(this.$iconContainer),s("<li/>",{html:'<i class="'+this.options.extraClass+" "+(e.value||e)+'"></i>',title:this.options.tooltip?e.text||e:""}).data("class",e.value||e).appendTo(this.$iconContainer.children().last()),this.iconsAll.push(e.value||e)}this.options.tooltip&&(s.asTooltip.closeAll(),this.$iconContainer.find("."+this.namespace+"-list li").asTooltip({namespace:"asTooltip",skin:"skin-dream",onlyOne:!0})),this.index=s.inArray(this.current,this.iconsAll),this.index>=0?this.set(this.current):this.set();var c=this;this.$iconContainer.asScrollable({contentClass:c.namespace+"-icons-content",wrapperClass:c.namespace+"-icons-wrapper"}),this._trigger("afterFill")},replaceDiacritics:function(s){var i,e="40-46 50-53 54-57 62-70 71-74 61 47 77".replace(/\d+/g,"\\3$&").split(" ");for(i in e)s=s.toLowerCase().replace(RegExp("["+e[i]+"]","g"),"aeiouncy".charAt(i));return s},highlight:function(s){s?this.$iconPicker.find("."+s).parent().addClass(this.classes.hover):this.$iconPicker.find("."+this.classes.hover).removeClass(this.classes.hover)},select:function(){this.$iconContainer.find("."+this.namespace+"-current").removeClass(this.namespace+"-current"),this.current&&this.$iconContainer.find("."+this.current).parent("li").addClass(this.namespace+"-current")},shadow:function(){this.$iconContainer.data("scroll")!==t&&(this.value>.1?this.$iconSearch.addClass(this.namespace+"-search-shadow"):this.$iconSearch.removeClass(this.namespace+"-search-shadow"))},scrollbar:function(){this.current&&(this.value=(this.index>0?this.index:1)/this.iconsAll.length),this.$iconContainer.asScrollable("move",this.value,!0),this.shadow()},set:function(i){i?this.$iconPicker.find("."+this.namespace+"-selected-icon").removeClass(this.namespace+"-none-selected").html('<i class="'+this.options.extraClass+" "+i+'"></i>'+this.options.process(i)):this.$iconPicker.find("."+this.namespace+"-selected-icon").addClass(this.namespace+"-none-selected").html('<i class="'+this.options.extraClass+" "+this.options.iconPrefix+"ban"+'"></i>'+this.options.emptyText),this.$element.val(i).triggerHandler("change"),this.current=i,this.index=s.inArray(this.current,this.iconsAll),this.scrollbar(),this.select()},reset:function(){this.$iconPicker.find("."+this.namespace+"-search-input").val(""),this.$iconSearch.removeClass(this.namespace+"-isSearching"),this.isSearch=!1,this.fillIcon(),this.$iconContainer.outerHeight()>=290&&this.$iconContainer.asScrollable()},_open:function(){var i=this.$wrapper.find("."+this.namespace+"-selector"),e=this;e.options.flat?(i.addClass(this.classes.flat),i.siblings("."+this.namespace+"-selector-popup").addClass(this.classes.flat).removeClass(this.classes.hide)):(i.addClass(this.classes.active),i.siblings("."+this.namespace+"-selector-popup").addClass(this.classes.active).removeClass(this.classes.hide),this.previous=this.current,i.hasClass(this.classes.active)&&!e.options.flat&&(this.$iconPicker.find("."+this.namespace+"-search-input").focus().select(),this.$mask=s("<div></div>").addClass(this.classes.mask).appendTo(this.$element.parent()),this.$mask.on("click",function(){e._hide()})))},_hide:function(){this.options.flat||(this.options.keyboard&&this._keyboard.destroy(this),this._clearMask(),this.$wrapper.find("."+this.namespace+"-selector").removeClass(this.classes.active),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide).removeClass(this.classes.active),this.$wrapper.focus())},_clearMask:function(){this.$mask&&(this.$mask.off(".asIconPicker"),this.$mask.remove(),this.$mask=null)},_trigger:function(s){this.$element.trigger("asIconPicker::"+s,this),this.$element.trigger(s+".asIconPicker",this),s=s.replace(/\b\w+\b/g,function(s){return s.substring(0,1).toUpperCase()+s.substring(1)});var i="on"+s,e=arguments.length>1?Array.prototype.slice.call(arguments,1):t;"function"==typeof this.options[i]&&this.options[i].apply(this,e)},load:function(s,i){s!==t&&(this.source=s),""===i?this.options.extraClass="":i!==t&&(this.options.extraClass=i),this.options.flat?this.showLoading():(this.$wrapper.find("."+this.namespace+"-selector-popup").removeClass(this.classes.hide),this.showLoading(),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide))},get:function(){var s;return s=this.current?this.$element.val():"None select"},val:function(s){return s?(this.set(s),t):this.get()},enable:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)},destory:function(){this.$element.data(n,null),this._trigger("destory")}},h.defaults=a,s.fn[n]=function(i){if("string"!=typeof i)return this.each(function(){s.data(this,n)||s.data(this,n,new h(this,i))});var e=i,a=arguments.length>1?Array.prototype.slice.call(arguments,1):t;if(/^\_/.test(e))return!1;if(!(/^(get)$/.test(e)||"val"===e&&a===t))return this.each(function(){var i=s.data(this,n);i&&"function"==typeof i[e]&&i[e].apply(i,a)});var r=this.first().data(n);return r&&"function"==typeof r[e]?r[e].apply(r,a):t}})(jQuery,document,window);