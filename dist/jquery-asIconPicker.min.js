/*! asIconPicker - v0.1.0 - 2014-07-04
* https://github.com/amazingsurge/jquery-asIconPicker
* Copyright (c) 2014 amazingSurge; Licensed MIT */
!function(a,b,c,d){"use strict";var e="asIconPicker",f={namespace:"asIconPicker",source:!1,tooltip:!0,hasSearch:!0,extraClass:"fa",iconPrefix:"fa-",emptyText:"None Selected",searchText:"Search",cancelSelected:!0,keyboard:!0,name:null,flat:!1,iconPicker:function(){return'<div class="namespace-selector"><span class="namespace-selected-icon">None selected</span><span class="namespace-selector-arrow"><i></i></span></div><div class="namespace-selector-popup"><div class="namespace-icons-container"></div></div>'},iconSearch:function(){return'<div class="namespace-selector-search"><input type="text" name="" value="" placeholder="searchText" class="namespace-search-input"/><i class="asIcon-search"></i></div>'},formatNoMatches:function(){return"No matches found"},errorHanding:function(){},process:function(a){return a.match(this.iconPrefix)?a.replace(this.iconPrefix,""):a},parse:function(a){return a.match(this.iconPrefix)?a:iconPrefix+a},onInit:null,onReady:null,onAfterFill:null},g=a[e]=function(b,c){this.element=b,this.$element=a(b),this.options=a.extend({},f,c,this.$element.data()),this._plugin=e,this.namespace=this.options.namespace,this.classes={disabled:this.namespace+"_disabled",wrapper:this.namespace+"-wrapper",search:this.namespace+"_with_search",active:this.namespace+"_active",flat:this.namespace+"_isFlat",hide:this.namespace+"_hide",hover:this.namespace+"_hover",mask:this.namespace+"-mask"},this.$element.addClass(this.namespace),this.$element.wrap('<div class="'+this.classes.wrapper+'"></div>'),this.$wrapper=this.$element.parent(),this.$wrapper.attr("tabindex","0");var d=this.options.iconPicker().replace(/namespace/g,this.namespace),g=this.options.iconSearch().replace(/namespace/g,this.namespace).replace(/searchText/g,this.options.searchText);this.$iconPicker=a(d),this.$iconContainer=this.$iconPicker.find("."+this.namespace+"-icons-container"),this.$iconSearch=a(g),this.options.hasSearch&&(this.$iconContainer.before(this.$iconSearch),this.$iconContainer.parent().addClass(this.classes.search),this.$searchIcon=this.$iconPicker.find("."+this.namespace+"-selector-search i"),this.iconsSearched=[],this.isSearch=!1),this.map={},this.bound=!1,this.current=this.$element.val(),this.source=[],this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()};g.prototype={constructor:g,_keyboard:{init:function(a){this.attach(a,this.gather(a))},destroy:function(a){a.$wrapper.off("keydown"),a.bound=!1},keys:function(){return{LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27}},horizontalChange:function(a){return this.$mask||this.options.flat?(this.index+=parseInt(a),this.index>=this.iconsAll.length?this.index=this.iconsAll.length-1:this.index<0&&(this.index=0),this.current=this.iconsAll[this.index],void this.set(this.current)):void this._open()},verticalChange:function(a){if(!this.$mask&&!this.options.flat)return void this._open();var b=this.$iconContainer.find("."+this.namespace+"-list").width(),c=this.$iconContainer.find("."+this.namespace+"-list li").width(),d=Math.floor(b/c);if(a=parseInt(a),this.index>=0&&this.$iconContainer.find("."+this.namespace+"-group").text()){if(1===a){var e=this.$iconContainer.find("."+this.current).parent().siblings().length+1,f=this.$iconContainer.find("."+this.current).parents("."+this.namespace+"-group").next().find("li").length,g=this.$iconContainer.find("."+this.current).parent().index(),h=e%d;this.index+=g+d>=e&&f?g+h>=e&&h>0?g+h>=e+f?f:h:g+h+d>=e+f?h+f:h+d:d}else if(-1===a){var e=this.$iconContainer.find("."+this.current).parent().siblings().length+1,i=this.$iconContainer.find("."+this.current).parents("."+this.namespace+"-group").prev().find("li").length,g=this.$iconContainer.find("."+this.current).parent().index(),h=i%d;this.index-=g>h-1&&d>g?i>=d?d+h:g+1:h-1>=g?h:d}}else this.index+=d*a;this.index>=this.iconsAll.length?this.index=this.iconsAll.length-1:this.index<0&&(this.index=0),this.current=this.iconsAll[this.index],this.set(this.current)},enter:function(){this.$mask?this.current&&(this.set(this.current),this._hide()):this._open()},esc:function(){this.set(this.previous),this._hide()},tab:function(){this._hide()},gather:function(b){return{left:a.proxy(this.horizontalChange,b,"-1"),up:a.proxy(this.verticalChange,b,"-1"),right:a.proxy(this.horizontalChange,b,"1"),down:a.proxy(this.verticalChange,b,"1"),enter:a.proxy(this.enter,b),esc:a.proxy(this.esc,b)}},press:function(b){var c=b.keyCode||b.which;if(9===c&&this._keyboard.tab.call(this),c in this.map&&"function"==typeof this.map[c])return b.preventDefault(),this.map[c].call(this);var d=this;this.$iconPicker.find("."+this.namespace+"-search-input").one("keyup",function(){d.searching(a(this).val())})},attach:function(a,b){var c,e=this;for(c in b)if(b.hasOwnProperty(c)){var f=[],g=a._stringSeparate(c,"_"),h=g.length;if(1===h)f[0]=g[0].toUpperCase(),a.map[this.keys()[f[0]]]=b[c];else for(var i=0;i<g.length;i++)f[i]=g[i].toUpperCase(),0===i?a.map[this.keys()[f[0]]]===d&&(a.map[this.keys()[f[0]]]={}):a.map[this.keys()[f[0]]][this.keys()[f[i]]]=b[c]}a.bound||(a.bound=!0,a.$wrapper.on("keydown",function(b){e.press.call(a,b)}))}},init:function(){var b=this;if(this.$element.hide(),this.$element.before(this.$iconPicker),!this.options.source&&this.$element.is("select"))this.$element.children().each(a.proxy(function(c,d){var e=[];if("optgroup"===d.tagName.toLowerCase()){for(var f=a.extend({},a(d).data(),{label:d.label,options:[]}),g=0;g<a(d).children().length;g++)e=[],e.value=a(d).children().eq(g).val(),e.text=a(d).children().eq(g).text(),f.options.push(e);b.source.push(f)}else a(d).val()&&(e.value=a(d).val(),e.text=a(d).text(),this.source.push(e))},this));else for(var c in this.options.source){var d=[];if(this.options.source[c].label){var e=[];e.label=this.options.source[c].label,e.options=[];for(var f in this.options.source[c].options)d=[],d.value=parseInt(f)>=0?this.options.source[c].options[f]:f,d.text=this.options.source[c].options[f],e.options.push(d);this.source.push(e)}else d.value=c,d.text=this.options.source[c],this.source.push(d)}this.showLoading(),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide),b.options.flat?b._open():this.$wrapper.find("."+this.namespace+"-selector").on("click",function(){b._open()}),this.options.keyboard?this.$wrapper.on("focus",function(){b._keyboard.init(b)}):this.$iconPicker.find("."+this.namespace+"-search-input").keyup(a.proxy(function(c){b.searching(a(c.currentTarget).val())},this)),this.$iconPicker.find("."+this.namespace+"-selector-search").on("click",".asIcon-times",a.proxy(function(){this.$iconPicker.find("."+this.namespace+"-search-input").focus().select(),this.reset()},this)),this.$iconContainer.on("click","."+this.namespace+"-list li",a.proxy(function(b){return this.options.cancelSelected&&a(b.currentTarget).hasClass(this.namespace+"-current")?(a(b.currentTarget).removeClass(this.namespace+"-current"),void this.set()):(this.set(a(b.currentTarget).data("class")),void this._hide())},this)).on("mouseenter","."+this.namespace+"-list li",a.proxy(function(b){this.highlight(a(b.currentTarget).data("class"))},this)).on("mouseleave","."+this.namespace+"-list li",a.proxy(function(){this.highlight()},this)),this.$iconContainer.on("change.asScrollable",function(a,c){b.value=c,b.shadow()}),this.$iconPicker.click(function(a){return a.stopPropagation(),b.$iconPicker.find("."+b.namespace+"-search-input").focus().select(),!1}),this.initialized=!0,this._trigger("ready")},_stringSeparate:function(a,b){var c=new RegExp("[.\\"+b+"\\s].*?"),b=a.match(c),d=a.split(b);return d},showLoading:function(){this.$iconContainer.html('<span class="'+this.namespace+'-loading"><i></i></span>'),this.source.length>0&&this.fillIcon()},searching:function(b){var c=this;if(""===b)return void this.reset();this.$iconSearch.addClass(this.namespace+"-isSearching"),this.isSearch=!0,this.iconsSearched=[];for(var d,e=0;d=this.source[e];e++)if("undefined"!=typeof d.label){var f=[];f.label=d.label,f.options=a.grep(d.options,function(a){return c.replaceDiacritics(a.value||a).toLowerCase().search(b.toLowerCase())>=0}),f.options.length>0&&(this.iconsSearched.push(f),this.current=this.iconsSearched[0].options[0].value||this.iconsSearched[0].options[0])}else this.replaceDiacritics(d.value).toLowerCase().search(b.toLowerCase())>=0?this.iconsSearched.push(d):0,this.iconsSearched.length>0&&(this.current=this.iconsSearched[0].value);this.fillIcon()},fillIcon:function(){"undefined"!=typeof this.$iconContainer.data("scroll")&&this.$iconContainer.asScrollable("destory");var b=[];if(this.iconsAll=[],b=this.isSearch?this.iconsSearched:this.source,b.length<1)return void this.$iconContainer.html('<div class="'+this.namespace+'-noMatch">'+this.options.formatNoMatches()+"</div>");this.$iconContainer.html("");for(var c,d=0;c=b[d];d++)if("undefined"!=typeof c.label){if(c.options.length)var e=a('<div class="'+this.namespace+'-group"><div class="'+this.namespace+'-group-label">'+c.label+':</div><ul class="'+this.namespace+'-list"></ul></div>').appendTo(this.$iconContainer);for(var f,g=0;f=c.options[g];g++)a("<li/>",{html:'<i class="'+this.options.extraClass+" "+(f.value||f)+'"></i>',title:this.options.tooltip?f.text||f:""}).data("class",f.value||f).appendTo(e.find("ul")),this.iconsAll.push(f.value||f)}else{var h=this.$iconContainer.children().last().attr("class");h!==this.namespace+"-list"&&a('<ul class="'+this.namespace+'-list"></ul>').appendTo(this.$iconContainer),a("<li/>",{html:'<i class="'+this.options.extraClass+" "+(c.value||c)+'"></i>',title:this.options.tooltip?c.text||c:""}).data("class",c.value||c).appendTo(this.$iconContainer.children().last()),this.iconsAll.push(c.value||c)}this.options.tooltip&&(a.asTooltip.closeAll(),this.$iconContainer.find("."+this.namespace+"-list li").asTooltip({namespace:"asTooltip",skin:"skin-dream",onlyOne:!0})),this.index=a.inArray(this.current,this.iconsAll),this.index>=0?this.set(this.current):this.set();var i=this;this.$iconContainer.asScrollable({contentClass:i.namespace+"-icons-content",wrapperClass:i.namespace+"-icons-wrapper"}),this._trigger("afterFill")},replaceDiacritics:function(a){var b,c="40-46 50-53 54-57 62-70 71-74 61 47 77".replace(/\d+/g,"\\3$&").split(" ");for(b in c)a=a.toLowerCase().replace(RegExp("["+c[b]+"]","g"),"aeiouncy".charAt(b));return a},highlight:function(a){a?this.$iconPicker.find("."+a).parent().addClass(this.classes.hover):this.$iconPicker.find("."+this.classes.hover).removeClass(this.classes.hover)},select:function(){this.$iconContainer.find("."+this.namespace+"-current").removeClass(this.namespace+"-current"),this.current&&this.$iconContainer.find("."+this.current).parent("li").addClass(this.namespace+"-current")},shadow:function(){"undefined"!=typeof this.$iconContainer.data("scroll")&&(this.value>.1?this.$iconSearch.addClass(this.namespace+"-search-shadow"):this.$iconSearch.removeClass(this.namespace+"-search-shadow"))},scrollbar:function(){this.current&&(this.value=(this.index>0?this.index:1)/this.iconsAll.length),this.$iconContainer.asScrollable("move",this.value,!0),this.shadow()},reset:function(){this.$iconPicker.find("."+this.namespace+"-search-input").val(""),this.$iconSearch.removeClass(this.namespace+"-isSearching"),this.isSearch=!1,this.fillIcon(),this.$iconContainer.outerHeight()>=290&&this.$iconContainer.asScrollable()},_open:function(){var b=this.$wrapper.find("."+this.namespace+"-selector"),c=this;c.options.flat?(b.addClass(this.classes.flat),b.siblings("."+this.namespace+"-selector-popup").addClass(this.classes.flat).removeClass(this.classes.hide)):(b.addClass(this.classes.active),b.siblings("."+this.namespace+"-selector-popup").addClass(this.classes.active).removeClass(this.classes.hide),this.previous=this.current,b.hasClass(this.classes.active)&&!c.options.flat&&(this.$iconPicker.find("."+this.namespace+"-search-input").focus().select(),this.$mask=a("<div></div>").addClass(this.classes.mask).appendTo(this.$element.parent()),this.$mask.on("click",function(){c._hide()})))},_hide:function(){this.options.flat||(this.options.keyboard&&this._keyboard.destroy(this),this._clearMask(),this.$wrapper.find("."+this.namespace+"-selector").removeClass(this.classes.active),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide).removeClass(this.classes.active),this.$wrapper.focus())},_clearMask:function(){this.$mask&&(this.$mask.off(".asIconPicker"),this.$mask.remove(),this.$mask=null)},_trigger:function(a){this.$element.trigger("asIconPicker::"+a,this),this.$element.trigger(a+".asIconPicker",this),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var b="on"+a,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;"function"==typeof this.options[b]&&this.options[b].apply(this,c)},load:function(a,b){"undefined"!=typeof a&&(this.source=a),""===b?this.options.extraClass="":"undefined"!=typeof b&&(this.options.extraClass=b),this.options.flat?this.showLoading():(this.$wrapper.find("."+this.namespace+"-selector-popup").removeClass(this.classes.hide),this.showLoading(),this.$wrapper.find("."+this.namespace+"-selector-popup").addClass(this.classes.hide))},get:function(){var a;return a=this.current?this.$element.val():"None select"},set:function(b){b?this.$iconPicker.find("."+this.namespace+"-selected-icon").removeClass(this.namespace+"-none-selected").html('<i class="'+this.options.extraClass+" "+b+'"></i>'+this.options.process(b)):this.$iconPicker.find("."+this.namespace+"-selected-icon").addClass(this.namespace+"-none-selected").html('<i class="'+this.options.extraClass+" "+this.options.iconPrefix+'ban"></i>'+this.options.emptyText),this.$element.val(b).triggerHandler("change"),this.current=b,this.index=a.inArray(this.current,this.iconsAll),this.scrollbar(),this.select()},clear:function(){this.set(null)},val:function(a){if("undefined"==typeof a)return this.options.process(this.value);var b=this.options.parse(a);b?this.set(b):this.clear()},enable:function(){this.disabled=!1,this.$wrapper.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrapper.addClass(this.classes.disabled)},destory:function(){this.$element.data(e,null),this._trigger("destory")}},g.defaults=f,a.fn[e]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,e)||a.data(this,e,new g(this,b))});var c=b,f=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if(!(/^(get)$/.test(c)||"val"===c&&f===d))return this.each(function(){var b=a.data(this,e);b&&"function"==typeof b[c]&&b[c].apply(b,f)});var h=this.first().data(e);return h&&"function"==typeof h[c]?h[c].apply(h,f):void 0}}(jQuery,document,window);